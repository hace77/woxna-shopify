{% comment %}
  Renders product variant options from custom-built list (includes unavailable options)
  
  Accepts:
  - product: {Object} product object
  - option_name: {String} name of the option (e.g., "Size")
  - option_position: {Number} position index (0, 1, or 2)
  - option_values_list: {Array} array of all option values
  - selected_value: {String} currently selected value
  - block: {Object} block object
  - picker_type: {String} type of picker
  - product_form_id: {String} form ID
  - section_id: {String} section ID
{% endcomment %}

{%- for option_value_item in option_values_list -%}
  {%- liquid
    # Handle both string values and option value objects
    assign option_value = option_value_item
    if option_value_item.value
      assign option_value = option_value_item.value
      # If it's an option value object, check its availability
      if option_value_item.available
        assign value_available = true
      else
        assign value_available = false
      endif
    else
      assign value_available = false
    endif
    
    # Find matching variant and check availability
    assign matching_variant = null
    assign value_product_url = product.url
    
    for variant in product.variants
      if variant.options[option_position] == option_value
        assign matching_variant = variant
        if variant.available
          assign value_available = true
          assign value_product_url = variant.url | default: product.url
          break
        endif
      endif
    endfor
    
    # If no available variant found, use the first matching variant for URL
    if matching_variant == null
      for variant in product.variants
        if variant.options[option_position] == option_value
          assign matching_variant = variant
          assign value_product_url = variant.url | default: product.url
          break
        endif
      endfor
    endif
    
    assign option_disabled = true
    if value_available
      assign option_disabled = false
    endif
    
    # Check if this value is selected
    assign is_selected = false
    if selected_value == option_value
      assign is_selected = true
    endif
    
    # Generate input ID
    assign input_id = section_id | append: '-' | append: option_position | append: '-' | append: forloop.index0
    assign input_name = option_name | append: '-' | append: option_position
  -%}
  
  {%- if picker_type == 'button' -%}
    <input
      type="radio"
      id="{{ input_id }}"
      name="{{ input_name | escape }}"
      value="{{ option_value | escape }}"
      form="{{ product_form_id }}"
      {% if is_selected %}
        checked
      {% endif %}
      {% if option_disabled %}
        class="disabled"
        disabled
      {% endif %}
      data-product-url="{{ value_product_url }}"
      data-option-value-id="{{ matching_variant.id | default: '' }}"
    >
    <label for="{{ input_id }}">
      {%- if option_disabled -%}
        {{- 'products.product.value_unavailable' | t: option_value: option_value -}}
      {%- else -%}
        {{ option_value -}}
        <span class="visually-hidden label-unavailable">
          {{- 'products.product.variant_sold_out_or_unavailable' | t -}}
        </span>
      {%- endif -%}
    </label>
  {%- elsif picker_type == 'dropdown' or picker_type == 'swatch_dropdown' -%}
    <option
      id="{{ input_id }}"
      value="{{ option_value | escape }}"
      {% if is_selected %}
        selected="selected"
      {% endif %}
      data-product-url="{{ value_product_url }}"
      data-option-value-id="{{ matching_variant.id | default: '' }}"
    >
      {% if option_disabled -%}
        {{- 'products.product.value_unavailable' | t: option_value: option_value -}}
      {%- else -%}
        {{- option_value -}}
      {%- endif %}
    </option>
  {%- elsif picker_type == 'swatch' -%}
    {%- comment -%} Swatch rendering would go here, but keeping it simple for now {%- endcomment -%}
    {%- liquid
      assign swatch_value = null
      if matching_variant and matching_variant.featured_image
        assign swatch_value = matching_variant.featured_image
      endif
    -%}
    {%- if swatch_value -%}
      {%- capture help_text -%}
        <span class="visually-hidden">{{ option_value | escape }}</span>
        {%- if option_disabled -%}
          <span class="visually-hidden label-unavailable">
            {{- 'products.product.variant_sold_out_or_unavailable' | t -}}
          </span>
        {%- endif -%}
      {%- endcapture -%}
      {%
        render 'swatch-input',
        id: input_id,
        name: input_name,
        value: option_value | escape,
        swatch: swatch_value,
        product_form_id: product_form_id,
        checked: is_selected,
        visually_disabled: option_disabled,
        shape: block.settings.swatch_shape,
        help_text: help_text,
        additional_props: 'data-product-url="' | append: value_product_url | append: '" data-option-value-id="' | append: matching_variant.id | append: '"'
      %}
    {%- else -%}
      {%- comment -%} Fallback to button style if no swatch {%- endcomment -%}
      <input
        type="radio"
        id="{{ input_id }}"
        name="{{ input_name | escape }}"
        value="{{ option_value | escape }}"
        form="{{ product_form_id }}"
        {% if is_selected %}
          checked
        {% endif %}
        {% if option_disabled %}
          class="disabled"
          disabled
        {% endif %}
        data-product-url="{{ value_product_url }}"
        data-option-value-id="{{ matching_variant.id | default: '' }}"
      >
      <label for="{{ input_id }}">
        {%- if option_disabled -%}
          {{- 'products.product.value_unavailable' | t: option_value: option_value -}}
        {%- else -%}
          {{ option_value -}}
        {%- endif -%}
      </label>
    {%- endif -%}
  {%- endif -%}
{%- endfor -%}

